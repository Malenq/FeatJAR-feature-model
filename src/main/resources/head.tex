%---required packages & variable definitions------------------------------------
\usepackage{forest}
\usepackage{amsmath}
\usepackage{xcolor}
\usetikzlibrary{angles}
\usetikzlibrary{positioning}
\definecolor{drawColor}{RGB}{128 128 128}
\newcommand{\circleSize}{0.25em}
%-------------------------------------------------------------------------------
%---Define the style of the tree------------------------------------------------
\forestset{
    /tikz/mandatory/.style={
        circle,fill=drawColor,
        draw=drawColor,
        inner sep=\circleSize
    },
    /tikz/optional/.style={
        circle,
        fill=white,
        draw=drawColor,
        inner sep=\circleSize
    },
    featureDiagram/.style={
        for tree={
            draw = drawColor,
            edge = {draw=drawColor},
            anchor=north,
            parent anchor = south,
            child anchor = north,
            l sep = 2em,
            s sep = 1em,
        }
    },
    /tikz/abstract/.style={
        fill = blue!85!cyan!5,
        draw = drawColor
    },
    /tikz/concrete/.style={
        fill = blue!85!cyan!20,
        draw = drawColor
    },
    mandatory/.style={
        edge label+={
            node [mandatory] {}
        }
    },
    optional/.style={
        edge label+={
            node [optional] {}
        }
    },
    featurecardinality/.style n args={2}{
        edge label+={
            node[midway,fill=white,font=\scriptsize]{#1,#2}
        }
    },
    or/.style n args={3}{
        tikz+={
            \path
            (!{current, n=#1}.parent) coordinate (A) -- (!c.children) coordinate (B) -- (!{current, n=#2}.parent) coordinate (C) -- (!{current, n=#3}.parent) coordinate (D)
            let \p1 = (A), \p2 = (B), \p3 = (C), \p4 = (D), \n1 = {veclen(\x2 - \x1, \y2 - \y1)}, \n2 = {veclen(\x2 - \x3, \y2 - \y3)}, \n3 = {veclen(\x2 - \x4, \y2 - \y4)}
            in pic[
            fill=drawColor,
            angle radius={min(\n1/2,\n2/2,\n3/2)}
            ]{angle};
        }
    },
    alternative/.style n args={3}{
        tikz+={
            \path
            (!{current, n=#1}.parent) coordinate (A) -- (!c.children) coordinate (B) -- (!{current, n=#2}.parent) coordinate (C) -- (!{current, n=#3}.parent) coordinate (D)
            let \p1 = (A), \p2 = (B), \p3 = (C), \p4 = (D), \n1 = {veclen(\x2 - \x1, \y2 - \y1)}, \n2 = {veclen(\x2 - \x3, \y2 - \y3)}, \n3 = {veclen(\x2 - \x4, \y2 - \y4)}
            in pic[
            draw=drawColor,
            angle radius={min(\n1/2,\n2/2,\n3/2)}
            ]{angle};
        }
    },
    groupcardinality/.style n args={5}{
        tikz+={
            \path (!{current, n=#1}.parent) coordinate (A) -- (!c.children) coordinate (B) -- (!{current, n=#2}.parent) coordinate (C) -- (!{current, n=#3}.parent) coordinate (D)
            let \p1 = (A), \p2 = (B), \p3 = (C), \p4 = (D), \n1 = {veclen(\x2 - \x1, \y2 - \y1)}, \n2 = {veclen(\x2 - \x3, \y2 - \y3)}, \n3 = {veclen(\x2 - \x4, \y2 - \y4)}
            in pic[
            draw=drawColor,
            angle radius={min(\n1/2,\n2/2,\n3/2)},
            pic text={#4,#5},
            pic text options={
                scale=0.6,
                fill=white,
                inner sep=0.3pt
            }
            ]{angle};
        }
    },
    /tikz/placeholder/.style={
    },
    collapsed/.style={
        rounded corners,
        no edge,
        for tree={
            fill opacity=0,
            draw opacity=0,
            l = 0em,
        }
    },
    /tikz/hiddenNodes/.style={
        midway,
        rounded corners,
        draw=drawColor,
        fill=white,
        minimum size = 1.2em,
        minimum width = 0.8em,
        scale=0.9
    }
}
%-------------------------------------------------------------------------------